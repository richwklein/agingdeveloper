---
import Layout from "@layouts/Layout.astro";
import slugify from "@sindresorhus/slugify";
import BreadcrumbHeader from "@components/BreadcrumbHeader.astro";
import { getCategories, getArticlesByCategory } from "@utils/article";
import DisplayLimitAlert from "@components/DisplayLimitAlert.astro";
import InternalBackLink from "@components/InternalBackLink.astro";
import InternalLink from "@components/InternalLink.astro";

interface Props {
  category: string;
}

export async function getStaticPaths() {
  const pages = (await getCategories()).map((category) => {
    return {
      params: { slug: slugify(category) },
      props: { category: category },
    };
  });

  return pages;
}

const { category } = Astro.props;
const limit = import.meta.env.ARTICLE_DISPLAY_LIMIT;
const entries = await getArticlesByCategory(category, limit);
---

<Layout title={`${category} | Tags`}>
  <BreadcrumbHeader
    head={{ name: "Categories", path: "/category" }}
    tail={category}
    class:list={["mb-4"]}
  />
  <ol>
    {
      entries.map((entry) => (
        <li>
          <InternalLink to={`/article/${entry.slug}`}>{entry.data.title}</InternalLink>
        </li>
      ))
    }
  </ol>
  <DisplayLimitAlert total={entries.length} limit={limit} class:list={["mt-4"]} />
  <InternalBackLink class:list={["mt-4"]} name={"categories"} path={"/category"} />
</Layout>
