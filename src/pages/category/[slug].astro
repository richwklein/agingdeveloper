---
import Layout from "@layouts/Layout.astro"
import slugify from "@sindresorhus/slugify"
import BreadcrumbHeader from "@components/BreadcrumbHeader.astro"
import { getCategories, getArticlesByCategory } from "@utils/article"
import DisplayLimitAlert from "@components/DisplayLimitAlert.astro"
import InternalBackLink from "@components/InternalBackLink.astro"
import ArticleGrid from "@components/ArticleGrid.astro"
import { getSite } from "@utils/site"

interface Props {
  category: string
}

export async function getStaticPaths() {
  const pages = (await getCategories()).map((category) => {
    return {
      params: { slug: slugify(category) },
      props: { category: category },
    }
  })

  return pages
}

const { category } = Astro.props
const siteEntry = await getSite()
const limit = siteEntry.data.displayLimit
const { entries, total } = await getArticlesByCategory(category, limit)
---

<Layout title={`${category} | Tags`}>
  <BreadcrumbHeader
    head={{ name: "Categories", path: "/category" }}
    tail={category}
    class:list={["mb-4"]}
  />
  <ArticleGrid articles={entries} class:list={["mt-4"]} />
  <DisplayLimitAlert displayed={entries.length} total={total} class:list={["mt-4"]} />
  <InternalBackLink class:list={["mt-4"]} name={"categories"} path={"/category"} />
</Layout>
