---
/**
 * A page for a single category with the latest articles for that category.
 */
import Layout from '@layouts/Layout.astro'
import slugify from '@sindresorhus/slugify'
import BreadcrumbHeader from '@components/BreadcrumbHeader.astro'
import { getCategories, getArticlesByCategory } from '@utils/article'
import DisplayLimitAlert from '@components/DisplayLimitAlert.astro'
import BackLink from '@components/BackLink.astro'
import ArticleGrid from '@components/ArticleGrid.astro'
import { getSite, getSiteAuthor } from '@utils/site'
import type { CollectionEntry } from 'astro:content'
import SeoBasic from '@components/seo/SeoBasic.astro'
import BreadcrumbJson from '@components/seo/BreadcrumbJson.astro'

interface Props {
  category: string
  site: CollectionEntry<'site'>
  siteAuthor: CollectionEntry<'author'>
}

export async function getStaticPaths() {
  const site = await getSite()
  const siteAuthor = await getSiteAuthor()
  const categories = await getCategories()
  const pages = categories.map((category) => {
    return {
      params: { slug: slugify(category) },
      props: { category, site, siteAuthor },
    }
  })

  return pages
}

const { category, site, siteAuthor } = Astro.props
const limit = site.data.displayLimit
const { entries, total } = await getArticlesByCategory(category, limit)
const categoryPath = Astro.url.pathname
---

<Layout site={site}>
  <Fragment slot="seo">
    <SeoBasic
      title={`Latest ${category} Articles: Expert Insights & Tips`}
      description={`Explore our selection of ${category} articles, offering valuable insights, practical tips, and up-to-date trends.`}
      path={categoryPath}
      author={siteAuthor}
    />
    <BreadcrumbJson
      site={site}
      crumbs={[
        { name: 'Categories', path: '/category' },
        { name: category, path: categoryPath },
      ]}
    />
  </Fragment>
  <BreadcrumbHeader
    head={{ name: 'Categories', path: '/category' }}
    tail={category}
    class:list={['mb-4']}
  />
  <ArticleGrid articles={entries} class:list={['mt-4']} />
  <DisplayLimitAlert displayed={entries.length} total={total} class:list={['mt-4']} />
  <BackLink class:list={['mt-4']} name={'categories'} to={'/category'} />
</Layout>
