---
import Layout from "@layouts/Layout.astro";
import slugify from "@sindresorhus/slugify";
import BreadcrumbHeader from "@components/BreadcrumbHeader.astro";
import { getTags, getArticlesByTag } from "@utils/article";
import DisplayLimitAlert from "@components/DisplayLimitAlert.astro";
import InternalBackLink from "@components/InternalBackLink.astro";
import ArticleGrid from "@components/ArticleGrid.astro";

interface Props {
  tag: string;
}

export async function getStaticPaths() {
  const pages = (await getTags()).map((tag) => {
    return {
      params: { slug: slugify(tag) },
      props: { tag: tag },
    };
  });

  return pages;
}

const { tag } = Astro.props;
const limit = import.meta.env.ARTICLE_DISPLAY_LIMIT;
const { entries, total } = await getArticlesByTag(tag, limit);
---

<Layout title={`${tag} | Tags`}>
  <BreadcrumbHeader head={{ name: "Tags", path: "/tag" }} tail={tag} class:list={["mb-4"]} />
  <ArticleGrid articles={entries} class:list={["mt-4"]} />
  <DisplayLimitAlert displayed={entries.length} total={total} class:list={["mt-4"]} />
  <InternalBackLink class:list={["mt-4"]} name={"tags"} path={"/tag"} />
</Layout>
