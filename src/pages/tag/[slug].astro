---
/**
 * A single tag page with the latest articles for that tag.
 */
import Layout from "@layouts/Layout.astro"
import slugify from "@sindresorhus/slugify"
import BreadcrumbHeader from "@components/BreadcrumbHeader.astro"
import { getTags, getArticlesByTag } from "@utils/article"
import DisplayLimitAlert from "@components/DisplayLimitAlert.astro"
import InternalBackLink from "@components/InternalBackLink.astro"
import ArticleGrid from "@components/ArticleGrid.astro"
import { getSite, getSiteAuthor } from "@utils/site"
import type { CollectionEntry } from "astro:content"
import SeoBasic from "@components/seo/SeoBasic.astro"
import BreadcrumbJson from "@components/seo/BreadcrumbJson.astro"

interface Props {
  tag: string
  site: CollectionEntry<"site">
  siteAuthor: CollectionEntry<"author">
}

export async function getStaticPaths() {
  const site = await getSite()
  const siteAuthor = await getSiteAuthor()

  const tags = await getTags()

  const pages = tags.map((tag) => {
    return {
      params: { slug: slugify(tag) },
      props: { tag, site, siteAuthor },
    }
  })

  return pages
}

const { tag, site, siteAuthor } = Astro.props
const limit = site.data.displayLimit
const { entries, total } = await getArticlesByTag(tag, limit)
const tagPath = Astro.url.pathname
---

<Layout site={site}>
  <Fragment slot="seo">
    <SeoBasic
      title={`Tagged Articles: Explore Content on ${tag}`}
      description={`Discover all articles tagged with ${tag}. Dive into a collection of posts that share a common theme.`}
      path={tagPath}
      author={siteAuthor}
    />
    <BreadcrumbJson
      site={site}
      crumbs={[
        { name: "Tags", path: "/tag" },
        { name: tag, path: tagPath },
      ]}
    />
  </Fragment>
  <BreadcrumbHeader head={{ name: "Tags", path: "/tag" }} tail={tag} class:list={["mb-4"]} />
  <ArticleGrid articles={entries} class:list={["mt-4"]} />
  <DisplayLimitAlert displayed={entries.length} total={total} class:list={["mt-4"]} />
  <InternalBackLink class:list={["mt-4"]} name={"tags"} path={"/tag"} />
</Layout>
