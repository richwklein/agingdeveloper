---
/**
 * @name ArticleJson
 * Component used to build out an ld+json article header.
 *
 * @return {Function} an Astro component factory function.
 *
 * @example
 * <ArticleJson article={article} author={author} wordCount={frontmatter.wordCount} />
 */
import slugify from "@sindresorhus/slugify"
import type { CollectionEntry } from "astro:content"

interface Props {
  article: CollectionEntry<"article">
  author: CollectionEntry<"author">
  wordCount: number
}

const baseUrl = import.meta.env.SITE
const { article, author, wordCount } = Astro.props
const modifiedDate = article.data.modified ? article.data.modified : article.data.published
---

<script
  is:inline
  type="application/ld+json"
  set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    headline: article.data.title,
    description: article.data.description,
    image: [`${baseUrl}${article.data.featured.image.src.split("?")[0]}`],
    dateCreated: article.data.published.toISOString(),
    datePublished: article.data.published.toISOString(),
    dateModified: modifiedDate.toISOString(),
    author: [
      {
        "@type": "Person",
        name: author.data.name,
        url: `${baseUrl}/author/${slugify(author.id)}`,
      },
    ],
    wordCount: wordCount,
  })}
/>
